<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">

  <meta name="description" content="An app store for open source apps, developed and maintained by Double Dot Labs.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="generator" content="DDStore" />
	<title>DDStore Console</title>

	<meta name="theme-color" content="#FFFFFF">
  <meta name="mobile-web-app-capable" content="yes">
  <!-- <link rel="manifest" href="manifest.json"> -->

  <meta name="application-name" content="DDStore">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-tooltip" content="DDStore">
  <!-- <meta name="msapplication-config" content="/ieconfig.xml"> -->

	<!-- <link rel="shortcut icon" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="icon" sizes="24x24" href="/images/favicon-24.ico">
  <link rel="icon" sizes="32x32" href="/images/favicon-32.ico">
  <link rel="icon" sizes="48x48" href="/images/favicon-48.ico">
  <link rel="icon" sizes="64x64" href="/images/favicon-48.ico"> -->

	<meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta name="apple-mobile-web-app-title" content="DDStore">
  <!-- <link rel="apple-touch-icon-precomposed" href="/images/favicon-152.png"> -->

	<!-- firebase stuff -->
	<script src="https://www.gstatic.com/firebasejs/4.7.0/firebase.js"></script>
	<script>
  	var config = {
    	apiKey: "AIzaSyD4i89pKORT3k0z60zgMB5O7VIDG12BwzE",
    	authDomain: "ddstore-87442.firebaseapp.com",
    	databaseURL: "https://ddstore-87442.firebaseio.com",
    	projectId: "ddstore-87442",
    	storageBucket: "ddstore-87442.appspot.com",
    	messagingSenderId: "292878095265"
  	};
  	firebase.initializeApp(config);
	</script>
	<script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
	<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css" />

	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" rel="stylesheet">
  <link href="../css/styles.css" rel="stylesheet">

	<style>
		* {
			--normal-color: #FFF;
			--normal-color-half: rgba(255, 255, 255, 0.5);
			--normal-color-fifth: rgba(255, 255, 255, 0.2);
			--normal-color-tenth: rgba(255, 255, 255, 0.1);
			--normal-background: rgb(41, 58, 74);
			--normal-background-half: rgba(41, 58, 74, 0.5);
			--normal-background-tenth: rgba(41, 58, 74, 0.1);
			--dark-background: rgb(20, 29, 38);
			--dark-background-half: rgba(20, 29, 38, 0.5);
			--accent-color: #82B1FF;
		}

		body {
			background-color: var(--dark-background);
		}

		header {
			background-color: var(--dark-background-half);
		}

		header * {
			color: var(--normal-color);
		}

		#logo {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			white-space: nowrap;
			cursor: pointer;
			user-select: none;
		}

		#logo>* {
			font-weight: bolder;
			font-size: 1.75em;
			margin: 0;
			display: inline-block;
			margin-right: 0.5em;
		}

		#logo>img {
			height: 1.5em;
		}

		#logo>h1 {
			position: absolute;
		}

		#signin, #profile {
			display: block;
			position: absolute;
			padding: 0.4em 0.8em;
			top: 50%;
			right: 1.5em;
			cursor: pointer;
			transform: translateY(-50%);

			-moz-transition: background-color .25s;
			-o-transition: background-color .25s;
			-webkit-transition: background-color .25s;
			transition: background-color .25s;
		}

		#profile {
			display: flex;
			max-width: calc(50% - 4em);
			padding: 0.4em 0;
		}

		.profile {
			display: flex;
			align-items: center;
		}

		#profilePicture {
			width: 3em;
			height: 3em;
			border-radius: 1.5em;
			border: 1px solid #000;
		}

		#profileNames {
			display: none;
			margin-right: 1em;
			max-width: calc(100% - 4em);
			text-align: right;
		}

		#profileName {
			font-size: 1em;
		}

		#profileEmail {
			display: none;
			font-size: 0.8em;
		}

		#profileNotifications,
		#profileNotifications2 {
			display: none;
			align-items: center;
			margin-left: 1em;
		}

		#profileNotifications > i,
		#profileNotifications2 > i {
			transform: none;
			color: rgba(0, 0, 0, 0.5);
			color: var(--normal-color-half);
		}

		#profileNotifications.active > i,
		#profileNotifications2.active > i {
			color: #2962FF;
			color: var(--accent-color);
		}

		#profileNotifications2 {
			display: flex;
		}

		#notifications {
			display: none;
			position: fixed;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			z-index: 105;
			background-color: rgba(0, 0, 0, 0.5);
		}

		#notifications.active {
			display: block;
			animation-name: fadeIn;
			animation-duration: .25s;
		}

		#notificationsPanel {
			display: inline-block;
			position: fixed;
			top: 7em;
			right: 2em;
			background-color: white;
			min-width: 350px;
			max-width: 80%;
			min-height: 400px;
			max-height: 80%;
			text-align: center;
			border-radius: 0.25em;
			box-shadow: 0 0.1em 0.3em rgba(0, 0, 0, 0.37);
			overflow-x: hidden;
			overflow-y: auto;
			border: none;
		}

		#info {
			padding: 2em 0;
		}

		#info > div {
			padding: 2em calc(5vw + 1em);
		}

		.inset {
			padding: 1em;
		}

		@media(max-width: 599px) {

			.inset {
				padding: 0;
			}

			.tinycard:not(:last-child) {
				border-color: rgba(255, 255, 255, 0.1) !important;
			}

			.tinycard * {
				color: #FFF;
			}

		}

		@media(min-width: 600px) {
			#profileNames {
				display: block;
			}

			#profileNotifications {
				display: flex;
			}

			#profileNotifications2 {
				display: none;
			}
		}

		@media(min-width: 700px) {
			#profileEmail {
				display: inline;
			}
		}

		@media(min-width: 900px) {
			#profile {
				max-width: calc(25% - 4em);
			}

			#profileEmail {
				display: none;
			}
		}

		@media(min-width: 1200px) {
			#profileEmail {
				display: inline;
			}
		}
	</style>
</head>
<body>
	<header>
		<div id="logo" onclick="setPage('page=home');"><img src="https://doubledotlabs.github.io/images/logo.svg"><h1>Console</h1></div>
		<button id="signin" class="outline" onclick="location.href='../?page=signin';">
			SIGN IN
		</button>
		<span id="profile" style="display: none;">
			<a id="profileNotifications2" href="../notifications/"><i class="material-icons">notifications</i></a>
			<div class="profile" onclick="location.href='../?page=user';">
			  <div id="profileNames">
				  <span id="profileName"></span><br>
				  <span id="profileEmail"></span>
				</div>
			  <img id="profilePicture" class="userimage loadingimage">
			</div>
			<a id="profileNotifications" onclick="document.getElementById('notifications').className='active';"><i class="material-icons">notifications</i></a>
		</span>
	</header>
	<div id="notifications" onclick="this.className=null;">
		<iframe id="notificationsPanel" src="../notifications/index.html"></iframe>
	</div>
	<main id="main">
		<div style="text-align: center; padding: 4em;">
			<h3>Ready to get started?</h3>
			<button class="outline" onclick="setPage('page=app&new');">Publish an App</button>
		</div>
	</main>
	<footer id="footer">
		<span>DDStore is developed and maintained by <a href="https://doubledotlabs.github.io/">Double Dot Labs</a></span>
		<a href="https://doubledotlabs.github.io/tos/?ddstore">Terms of Service</a>
		<a href="https://doubledotlabs.github.io/policies/?ddstore">Privacy Policy</a>
	</footer>

	<script type="text/javascript" src="../js/utils.js"></script>
	<script type="text/javascript" src="../js/methods.js"></script>
	<script type="text/javascript" src="../js/content.js"></script>
	<script type="text/javascript" src="../js/github.js"></script>
	<script type="text/javascript" src="../js/console.js"></script>
	<script>
		var main = document.getElementById("main");
		var footer = document.getElementById("footer");
		var signInElement = document.getElementById("signin");
		var profileElement = document.getElementById("profile");
		var profileNameElement = document.getElementById("profileName");
		var profileEmailElement = document.getElementById("profileEmail");
		var profilePictureElement = document.getElementById("profilePicture");

		var currentUser;
		var isCurrentUserLoading = true;

		function setPage(page, replace) {
			document.body.style.background = null;
			main.style.background = null;
			var shouldScrollTop = true;

			if (!currentUser)
				return;

			var args = page;
			if (typeof page == "string") {
				args = UrlUtils.stringToArguments(page);
			} else page = UrlUtils.argumentsToString(args);

			if (!args.page) {
				args.page = "home";
				page = "?";
			}

			if (args.page == "home") {
				ElementUtils.clearElement(main);

				getUser(currentUser.uid, function(user) {
					if (user.apps && user.apps.length > 0) {
						ElementUtils.clearElement(main);

						ElementUtils.append(main, "<div class=\"inset\">"
							+ "<div class=\"row grid\">"+ ListMethods.none({}, user.apps, AppMethods.consoleTinyCard)
							+ "<a href=\"javascript:setPage(\'page=app&new\');\"><i class=\"material-icons\">add</i>NEW APPLICATION</a></div>"
							+ "</div>");
					}
				});
			} else if (args.page == "app") {
				if (args.package) {
					var editHeaderImageElement = document.getElementById("editHeaderImage");
					var editIconImageElement = document.getElementById("editIconImage");
					var appInfoContainerElement = document.getElementById("appInfoContainer");
					var appReleasesContainerElement = document.getElementById("appReleasesContainer");
					var appDescContainerElement = document.getElementById("appDescContainer");
					var appReviewsContainerElement = document.getElementById("appReviewsContainer");

					if (!document.getElementById("app:" + args.package)) {
						ElementUtils.clearElement(main);
						ElementUtils.append(main, "<useless id=\"app:" + args.package + "\"></useless><div id=\"editHeaderImage\" class=\"header loadingimage editable\"></div>"
							+ "<div class=\"appinfo\"><div class=\"appiconinfo\"><img id=\"editIconImage\" class=\"appicon editable\"></div>"
							+ "<div id=\"appInfoContainer\" class=\"appnameinfo\"></div></div>"
							+ "<div id=\"appReleasesContainer\"></div>"
							+ "<a class=\"indented\" href=\"javascript:setPage(\'page=releases&package=" + args.package + "\');\"><i class=\"material-icons\">open_in_new</i>ALL RELEASES</a>"
							+ "<a class=\"indented\" href=\"javascript:setPage(\'page=releases&package=" + args.package + "&edit=new\');\"><i class=\"material-icons\">add</i>NEW RELEASE</a><br><br><br>"
							+ "<hr>"
							+ "<div id=\"appDescContainer\" class=\"appdesc\"></div>"
							+ "<h1 class=\"indented\">Reviews</h1><div id=\"appReviewsContainer\" class=\"row grid\"></div>"
							+ "<a class=\"indented\" href=\"javascript:setPage(\'page=reviews&package=" + args.package + "\');\"><i class=\"material-icons\">open_in_new</i>ALL REVIEWS</a><br><br><br>");

						editHeaderImageElement = document.getElementById("editHeaderImage");
						editIconImageElement = document.getElementById("editIconImage");
						appInfoContainerElement = document.getElementById("appInfoContainer");
						appReleasesContainerElement = document.getElementById("appReleasesContainer");
						appDescContainerElement = document.getElementById("appDescContainer");
						appReviewsContainerElement = document.getElementById("appReviewsContainer");

						getApp(args.package, function(app) {
							if (!document.getElementById("app:" + args.package))
								return;

							document.body.style.background = "url(\"" + app.header + "\") 100% 100% / 9999% 9999% no-repeat fixed";
							main.style.background = "rgb(20, 29, 38)";

							editHeaderImageElement.style.background = "url(\'" + app.header + "\') center / cover no-repeat";
							editIconImageElement.src = app.icon;

							var releaseHtml = (app.releases && app.releases[0] ? ReleaseMethods.console(app.releases[0]) : null);
							ElementUtils.clearElement(appReleasesContainerElement);
							ElementUtils.append(appReleasesContainerElement, releaseHtml ? "<useless class=\"appinfo\"></useless><hr>" + releaseHtml.substring(30, releaseHtml.length - 6) : "");

							ElementUtils.clearElement(appReviewsContainerElement);
							ElementUtils.append(appReviewsContainerElement, app.reviews && app.reviews.length > 0 ? ListMethods.none({}, app.reviews, ReviewMethods.console) : "");
						});

						editHeaderImageElement.addEventListener("click", function() {
							if (window.File && window.FileReader && window.FileList && window.Blob) {
								var inputElement = ElementUtils.createElement("<input type=\"file\" accept=\"image/*\"></input>").childNodes[0];
								inputElement.click();
								inputElement.addEventListener("change", function() {
									if (FileReader && inputElement.files && inputElement.files[0]) {
										setAppHeader(args.package, inputElement.files[0], function() {
											var reader = new FileReader();
											reader.onload = function() {
												editHeaderImageElement.style.background = "url(\'" + reader.result + "\') center / cover no-repeat";
											}
											reader.readAsDataURL(inputElement.files[0]);
										});
									}
								});
							} else {
								//error
							}
						});

						editIconImageElement.addEventListener("click", function() {
							if (window.File && window.FileReader && window.FileList && window.Blob) {
								var inputElement = ElementUtils.createElement("<input type=\"file\" accept=\"image/*\"></input>").childNodes[0];
								inputElement.click();
								inputElement.addEventListener("change", function() {
									setAppIcon(args.package, inputElement.files[0], function() {
										if (FileReader && inputElement.files && inputElement.files[0]) {
											var reader = new FileReader();
											reader.onload = function() {
												editIconImageElement.src = reader.result;
											}
											reader.readAsDataURL(inputElement.files[0]);
										}
									});
								});
							} else {
								//error
							}
						});
					}

					if (args.edit == "page") {
						shouldScrollTop = false;
						ElementUtils.clearElement(appInfoContainerElement);

						getApp(args.package, function(app) {
							if (!document.getElementById("app:" + args.package))
								return;

							ElementUtils.clearElement(appInfoContainerElement);
							ElementUtils.append(appInfoContainerElement, "<div class=\"editingclicked\"><h1><div id=\"editAppName\" class=\"input long\" contentEditable=\"true\" placeholder=\"App Name\">" + app.name + "</div></h1>"
								+ "<div id=\"editAppSummary\" class=\"input long\" contentEditable=\"true\" placeholder=\"Summary\">" + app.summary + "</div>"
								+ "<div id=\"editLinks\" class=\"row overflow\" style=\"text-align: center; justify-content: center;\">"
								+ (app.links && app.links.length > 0 ? ListMethods.none({}, app.links, LinkMethods.editable) : LinkMethods.editable())
								+ "<div style=\"width: 100%;\"><a id=\"editAddLink\"><i class=\"material-icons\">add</i></a><a id=\"editRemoveLink\"><i class=\"material-icons\">remove</i></a></div>"
								+ "</div><br><button id=\"editAppSubmit\" class=\"outline indented\" style=\"float: right;\">SAVE</button><button class=\"outline\" style=\"float: right; margin-right: 1em;\" onclick=\"window.history.back();\">CANCEL</button><br><br><br></div>");

							var editLinksElement = document.getElementById("editLinks");
							var editAddLinkElement = document.getElementById("editAddLink");
							var editRemoveLinkElement = document.getElementById("editRemoveLink");

							editAddLinkElement.addEventListener("click", function() {
								if (editLinksElement.childNodes.length < 10)
									editLinksElement.insertBefore(ElementUtils.createElement(LinkMethods.editable()), editLinksElement.lastChild);
							});

							editRemoveLinkElement.addEventListener("click", function() {
								if (editLinksElement.childNodes.length >= 2)
									editLinksElement.removeChild(editLinksElement.childNodes[editLinksElement.childNodes.length - 2]);
							});

							document.getElementById("editAppSubmit").addEventListener("click", function() {
								var editAppNameElement = document.getElementById("editAppName");
								var editAppSummaryElement = document.getElementById("editAppSummary");

								var links = [];
								for (var i = 0; i < editLinksElement.childNodes.length; i++) {
									var linkName = null, linkUrl = null;
									var child = editLinksElement.childNodes[i];
									if (child.tagName.toLowerCase() == "div") {
										if (child.childNodes[0] && child.childNodes[0].tagName.toLowerCase() == "div") {
											linkName = child.childNodes[0].innerText;
										}

										if (child.childNodes[1] && child.childNodes[1].tagName.toLowerCase() == "div") {
											linkUrl = child.childNodes[1].innerText;
										}

										if (linkName && linkUrl) {
											links.push({
												"name": linkName,
												"url": linkUrl
											});
										}
									}
								}

								setAppPage(args.package, editAppNameElement.innerText, editAppSummaryElement.innerText, links, function() {
									window.history.back();
								});
							});
						});
					} else {
						ElementUtils.clearElement(appInfoContainerElement);

						getApp(args.package, function(app) {
							if (!document.getElementById("app:" + args.package))
								return;

							ElementUtils.clearElement(appInfoContainerElement);
							ElementUtils.append(appInfoContainerElement, "<div class=\"editonclick\" onclick=\"setPage('page=app&package=" + app.package + "&edit=page');\"><h1>" + app.name + "</h1><p>" + app.summary + "</p>"
									+ ListMethods.overflow({}, app.links, LinkMethods.normal) + "</div>");
						});
					}

					if (args.edit == "description") {
						shouldScrollTop = false;
						ElementUtils.clearElement(appDescContainerElement);
						getApp(args.package, function(app) {
							if (!document.getElementById("app:" + args.package))
								return;

							ElementUtils.clearElement(appDescContainerElement);

							ElementUtils.append(appDescContainerElement, "<div class=\"editingclicked\"><br><div id=\"editDescription\" class=\"input long\" contentEditable=\"true\" placeholder=\"Enter a description...\">"
								+ app.description + "</div><button id=\"editDescriptionSubmit\" class=\"outline\" style=\"float: right;\">SAVE</button><button class=\"outline\" style=\"float: right; margin-right: 1em;\" onclick=\"window.history.back();\">CANCEL</button><br><br></div>");

							var editDescriptionElement = document.getElementById("editDescription");
							document.getElementById("editDescriptionSubmit").addEventListener("click", function() {
								ElementUtils.clearElement(appDescContainerElement);
								setAppDescription(args.package, editDescriptionElement.innerHTML, function() {
									window.history.back();
								});
							});
						});
					} else {
						ElementUtils.clearElement(appDescContainerElement);
						getApp(args.package, function(app) {
							if (!document.getElementById("app:" + args.package))
								return;

							ElementUtils.clearElement(appDescContainerElement);
							ElementUtils.append(appDescContainerElement, "<div class=\"editonclick\" onclick=\"setPage('page=app&package=" + app.package + "&edit=description');\"><p>" + app.description + "</p></div>");
						});
					}
				} else if (args.new) {
					if (currentUser) {
						if (args.source == "manual") {

						} else if (args.source == "github") {
							if (GitHub.githubAccessToken) {
								GitHub.getRepositories(null, function(result) {
									ElementUtils.clearElement(main);

									ElementUtils.append(main, "<div id=\"repositories\" style=\"text-align: center;\"><h2>Select a Repository</h2></div><div style=\"text-align: center; margin-bottom: 2em;\"><button id=\"loadMoreRepositories\" class=\"outline\">Load More</button></div>");
									var repositoriesElement = document.getElementById("repositories");
									var loadMoreRepositoriesElement = document.getElementById("loadMoreRepositories");

									var lastItemCursor;
									var addRepositories = function(result) {
										var items = [];
										for (var i = 0; i < result.data.viewer.repositories.edges.length; i++) {
											items.push({
												"name": result.data.viewer.repositories.edges[i].node.name,
												"description": result.data.viewer.repositories.edges[i].node.description,
												"onclick": "" //TODO: yeah do the thing
											});

											lastItemCursor = result.data.viewer.repositories.edges[i].cursor;
										}

										ElementUtils.append(repositoriesElement, ListMethods.none({}, items, LinkMethods.largeButton));
									};

									addRepositories(result);

									loadMoreRepositoriesElement.addEventListener("click", function() {
										GitHub.getRepositories(lastItemCursor, addRepositories);
									});
								}, function(error) {

								});
							} else GitHub.signInToGithub();
						} else {
							ElementUtils.append(main, "<div style=\"margin: 2em; text-align: center;\">"
									+ LinkMethods.largeButton({
										"icon": "keyboard",
										"name": "Manual",
										"description": "Enter all the necessary information yourself, without using any third party services.",
										"onclick": "setPage(\'page=app&new&source=manual\');"
									})
									+ "<br><br>"
									+ LinkMethods.largeButton({
										"icon": "import_export",
										"name": "Import from GitHub",
										"description": "Simply select a repository and the site will attempt to collect all the necessary information to publish your app.",
										"onclick": "setPage(\'page=app&new&source=github\');"
									})
									+ "</div>");
						}
					} else {
						location.href = "../?page=signin";
					}
				} else {
					ElementUtils.clearElement(main);
					setPage("page=404");
					return;
				}
			} else if (args.page == "reviews") {
				ElementUtils.clearElement(main);

				if (args.id) {
					getReview(args.id, function(review) {
						ElementUtils.clearElement(main);
						ElementUtils.append(main, "<div class=\"single\">" + ReviewMethods.console(review) + "</div>");
					});
				} else {
					getAppReviews(args.package, function(reviews) {
						ElementUtils.clearElement(main);
						ElementUtils.append(main, "<div class=\"single\">" + ListMethods.grid({"name": "Reviews"}, reviews, ReviewMethods.console) + "</div>");
					});
				}
			} else if (args.page == "releases") {
				ElementUtils.clearElement(main);

				if (args.version) {
					if (args.edit) {
						getApp(args.package, function(app) {
							ElementUtils.clearElement(main);

							var release = null;
							for (var i = 0; i < app.releases.length; i++) {
								if (args.version == app.releases[i].version) {
									release = app.releases[i];
									break;
								}
							}

							if (release != null) {
								ElementUtils.append(main, "<div style=\"margin: 1em;\">"
									+ "<h1 class=\"indented\">Release: " + release.version + "</h1><h3 class=\"indented\">Published on " + release.date + "</h3>"
									+ "<div class=\"row grid\" style=\"padding: 0 1em;\">"
									+ ListMethods.none({}, release.downloads, DownloadMethods.consoleEdit)
									+ "<a><i class=\"material-icons\">file_upload</i>UPLOAD APK</a>"
									+ "</div>"
									+ "<h3 class=\"indented\">Changelog</h3>"
									+ "<div style=\"padding: 1em 2em;\"><div class=\"input long\" contentEditable=\"true\" placeholder=\"Changelog\">" + release.changelog.split("\n").join("<br>") + "</div>"
									+ "<button class=\"outline\" style=\"float: right;\">SUBMIT</button><br></div>"
									+ "</div>");
							} else {
								setPage("page=404", true);
							}
						});
					} else {
						getApp(args.package, function(app) {
							ElementUtils.clearElement(main);

							var release = null;
							for (var i = 0; i < app.releases.length; i++) {
								if (args.version == app.releases[i].version) {
									release = app.releases[i];
									break;
								}
							}

							ElementUtils.append(main, ReleaseMethods.console(release).substring(4));
						});
					}
				} else if (args.edit == "new") {
					//TODO: new release
				} else {
					getApp(args.package, function(app) {
						ElementUtils.clearElement(main);
						ElementUtils.append(main, "<div style=\"margin: 1em;\">" + ListMethods.none({}, app.releases, ReleaseMethods.console) + "</div>");
					});
				}
			}

			if (replace)
				window.history.replaceState({}, "", page ? "?" + page : "?");
			else {
				window.history.pushState({}, "", page ? "?" + page : "?");
				if (shouldScrollTop)
					window.scrollTo(0, 0);
			}

			onSizeChange();
		}

		setPage(UrlUtils.getCurrentArguments(), true);

		window.onpopstate = function() {
			setPage(UrlUtils.getCurrentArguments(), true);
			console.log("h");
		}

		window.addEventListener("load", function() {
			firebase.auth().onAuthStateChanged(function(user) {
				currentUser = user;
				isCurrentUserLoading = false;

				if (user) {
					signInElement.style.display = "none";
					profileElement.style.display = null;

					profileNameElement.innerHTML = user.displayName;
					profileEmailElement.innerHTML = user.email;
					profilePictureElement.src = user.photoURL;

					setPage(UrlUtils.getCurrentArguments(), true);
				} else {
					profileElement.style.display = "none";
					signInElement.style.display = null;
				}
			}, function(error) {
				isCurrentUserLoading = false;
				console.error("Sign In Error", error);
				//TODO: 404 page
			});
		});

		function onSizeChange() {
			footer.style.position = null;
			var rect = footer.getBoundingClientRect();
			if ((rect.bottom || rect.y + rect.height) < Math.max(document.documentElement.clientHeight, window.innerHeight || 0))
				footer.style.position = "fixed";
			else footer.style.position = null;
		}

		window.onresize = onSizeChange;
		ElementUtils.addElementListenerStuff(document.body);
		onSizeChange();
	</script>
</body>
</html>
