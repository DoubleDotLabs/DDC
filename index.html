<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">

  	<meta name="description" content="A distribution center for open source apps, developed and maintained by Double Dot Labs.">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<meta name="mobile-web-app-capable" content="yes">
  	<meta name="generator" content="Dot Distribution Center" />
  	<title>Dot Distribution Center</title>

  	<meta name="theme-color" content="#FFFFFF">
  	<meta name="mobile-web-app-capable" content="yes">
  	<!-- <link rel="manifest" href="manifest.json"> -->

  	<meta name="application-name" content="Dot Distribution Center">
  	<meta name="msapplication-TileColor" content="#FFFFFF">
  	<meta name="msapplication-tooltip" content="Dot Distribution Center">
  	<!-- <meta name="msapplication-config" content="/ieconfig.xml"> -->

	<!-- <link rel="shortcut icon" href="/favicon.ico">
  	<link rel="icon" sizes="16x16" href="/favicon.ico">
  	<link rel="icon" sizes="24x24" href="/images/favicon-24.ico">
  	<link rel="icon" sizes="32x32" href="/images/favicon-32.ico">
 	<link rel="icon" sizes="48x48" href="/images/favicon-48.ico">
  	<link rel="icon" sizes="64x64" href="/images/favicon-48.ico"> -->

	<meta name="apple-mobile-web-app-capable" content="yes">
  	<meta name="apple-mobile-web-app-status-bar-style" content="white">
  	<meta name="apple-mobile-web-app-title" content="Dot Distribution Center">
  	<!-- <link rel="apple-touch-icon-precomposed" href="/images/favicon-152.png"> -->

	<!-- firebase stuff -->
	<script src="https://www.gstatic.com/firebasejs/4.7.0/firebase.js"></script>
	<script>
  	var config = {
    	apiKey: "AIzaSyD4i89pKORT3k0z60zgMB5O7VIDG12BwzE",
    	authDomain: "ddstore-87442.firebaseapp.com",
    	databaseURL: "https://ddstore-87442.firebaseio.com",
    	projectId: "ddstore-87442",
    	storageBucket: "ddstore-87442.appspot.com",
    	messagingSenderId: "292878095265"
  	};
  	firebase.initializeApp(config);
	</script>
	<script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
	<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css" />

	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" rel="stylesheet">
  	<link href="css/styles.css" rel="stylesheet">

	<style>
		#logo {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			white-space: nowrap;
			cursor: pointer;
			user-select: none;
		}

		#logo>* {
			font-weight: bolder;
			margin: 0;
			padding: 0;
			margin-right: 0.5em;
		}
		
		#logo>h1 {
			font-size: 2em;
			transform: translateY(0);
			transition: transform .25s;
		}

		#logo:hover>h1 {
			transform: translateY(-.5em);
		}

		#logo>h4 {
			height: 0;
			font-size: 1em;
			transform: translateY(-1.5em);
			opacity: 0;
			transition: transform .25s, opacity .25s;
		}

		#logo:hover>h4 {
			transform: translateY(-1em);
			opacity: 1;
		}

		#loading {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: rgba(0, 0, 0, 0.5);
			color: var(--normal-color-half);
			text-align: center;

			animation-name: loadIn;
			animation-duration: 1.5s;
			animation-timing-function: ease-out;
			animation-fill-mode: forwards;
		}

		@keyframes loadIn {
			from {
				opacity: 0;
			}

			to {
				opacity: 1;
			}
		}

		#signin, #profile {
			display: block;
			position: absolute;
			padding: 0.4em 0.8em;
			top: 50%;
			right: 1.5em;
			cursor: pointer;
			transform: translateY(-50%);

			-moz-transition: background-color .25s;
			-o-transition: background-color .25s;
			-webkit-transition: background-color .25s;
			transition: background-color .25s;
		}

		#profile {
			display: flex;
			max-width: calc(50% - 4em);
			padding: 0.4em 0;
		}

		.profile {
			display: flex;
			align-items: center;
		}

		#profilePicture {
			width: 3em;
			height: 3em;
			border-radius: 1.5em;
			border: 1px solid #000;
		}

		#profileNames {
			display: none;
			margin-right: 1em;
			max-width: calc(100% - 4em);
			text-align: right;
		}

		#profileName {
			font-size: 1em;
		}

		#profileEmail {
			display: none;
			font-size: 0.8em;
		}

		#search {
			display: none;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 50%;
			border: none;
			background-color: rgba(0, 0, 0, 0.075);
			padding: 1em 1.4em;
			border-radius: 0.4em;
		}

		#search::placeholder {
			color: rgba(0, 0, 0, 0.5);
			font-weight: bold;
		}

		#profileNotifications,
		#profileNotifications2 {
			display: none;
			align-items: center;
			margin-left: 1em;
		}

		#profileNotifications > i,
		#profileNotifications2 > i {
			transform: none;
			color: rgba(0, 0, 0, 0.5);
			color: var(--normal-color-half);
		}

		#profileNotifications.active > i,
		#profileNotifications2.active > i {
			color: #2962FF;
			color: var(--accent-color);
		}

		#profileNotifications2 {
			display: flex;
		}

		#notifications {
			display: none;
			position: fixed;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			z-index: 105;
			background-color: rgba(0, 0, 0, 0.5);
		}

		#notifications.active {
			display: block;
			animation-name: fadeIn;
			animation-duration: .25s;
		}

		#notificationsPanel {
			display: inline-block;
			position: fixed;
			top: 7em;
			right: 2em;
			background-color: white;
			min-width: 350px;
			max-width: 80%;
			min-height: 400px;
			max-height: 80%;
			text-align: center;
			border-radius: 0.25em;
			box-shadow: 0 0.1em 0.3em rgba(0, 0, 0, 0.37);
			overflow-x: hidden;
			overflow-y: auto;
			border: none;
		}

		@media(min-width: 600px) {
			#profileNames {
				display: block;
			}

			#profileNotifications {
				display: flex;
			}

			#profileNotifications2 {
				display: none;
			}
		}

		@media(min-width: 700px) {
			#profileEmail {
				display: inline;
			}
		}

		@media(min-width: 900px) {
			#search {
				display: block;
			}

			#profile {
				max-width: calc(25% - 4em);
			}

			#profileEmail {
				display: none;
			}
		}

		@media(min-width: 1400px) {
			#profileEmail {
				display: inline;
			}
		}
	</style>
</head>
<body>
	<header>
		<div id="logo" onclick="setPage('page=home');">
			<h1>DDC</h1>
			<h4>Dot Distribution Center</h4>
		</div>
		<input id="search" type="text" placeholder="Search for Apps...">
		<button id="signin" class="outline" onclick="setPage('page=signin');">
			SIGN IN
		</button>
		<span id="profile" style="display: none;">
			<a id="profileNotifications2" href="./notifications/"><i class="material-icons">notifications</i></a>
			<div class="profile" onclick="setPage('page=user');">
			  <div id="profileNames">
				  <span id="profileName"></span><br>
				  <span id="profileEmail"></span>
				</div>
			  <img id="profilePicture" class="userimage loadingimage">
			</div>
			<a id="profileNotifications" onclick="document.getElementById('notifications').className='active';"><i class="material-icons">notifications</i></a>
		</span>
	</header>
	<div id="notifications" onclick="this.className=null;">
		<iframe id="notificationsPanel" src="./notifications/index.html"></iframe>
	</div>
	<main id="main"></main>
	<footer id="footer">
		<span>The Dot Distribution Center is developed and maintained by <a href="https://doubledotlabs.github.io/">Double Dot Labs</a></span>
		<a href="https://doubledotlabs.github.io/tos/?ddc">Terms of Service</a>
		<a href="https://doubledotlabs.github.io/policies/?ddc">Privacy Policy</a>
	</footer>

	<!-- jquery -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
  	<script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

	<!-- slick -->
  	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

	<script type="text/javascript" src="js/utils.js"></script>
	<script type="text/javascript" src="js/methods.js"></script>
	<script type="text/javascript" src="js/content.js"></script>
	<script>
		var main = document.getElementById("main");
		var footer = document.getElementById("footer");
		var signInElement = document.getElementById("signin");
		var searchElement = document.getElementById("search");
		var profileElement = document.getElementById("profile");
		var profileNameElement = document.getElementById("profileName");
		var profileEmailElement = document.getElementById("profileEmail");
		var profilePictureElement = document.getElementById("profilePicture");

		var currentUser;
		var isCurrentUserLoading = true;
		var firebaseUI;

		function setPage(page, replace) {
			document.body.style.background = null;
			main.style.background = null;
			searchElement.value = "";
			var shouldScrollTop = true;

			var args = page;
			if (typeof page == "string") {
				args = UrlUtils.stringToArguments(page);
			} else page = UrlUtils.argumentsToString(args);

			if (!args.page) {
				args.page = "home";
				page = "?";
			}

			if (args.page == "home") {
				page = null;
				setLoading();

				getCategory("featured", function(featured) {
					getCategories(function(categories) {
						ElementUtils.clearElement(main);

						var html = "<div style=\"padding: calc(5vw + 1em);\"><p>"
							+ "This is the Dot Distribution Center, a ridiculously large project that was obviously too much "
							+ "for me to take on by myself. The aim of this project is to bring awareness to smaller open source "
							+ "Android apps, and to not only provide a uniform way to distribute and access them but also the ability "
							+ "for users to write reviews and provide feedback to developers without the need of any technical knowledge. "
							+ "I originally started making it for a final project in one of my classes at school, which is why everything is "
							+ "written in vanilla JS and I have used as little libraries as possible. Since then, the website has become "
							+ "somewhat disorganized (mostly due to a lack of documentation) and many issues/inconveniences have been discovered in the "
							+ "<a href=\"https://github.com/DoubleDotLabs/DDC/tree/master/firebase\" style=\"text-transform: none;\">firebase spaghetti</a> that I wrote without much initial "
							+ "knowledge of how to use it. In order to solve these problems, much of the project will likely need to be rebuilt from scratch. "
							+ "Naturally, this project is open source and is published <a href=\"https://github.com/DoubleDotLabs/DDC\" style=\"text-transform: none;\">on GitHub</a>."
							+ "</p></div>";
						
						html += ListMethods.carousel({
							autoplay: true,
		  				centerMode: true,
		  				centerPadding: '80px',
		  				slidesToShow: 4,
							dots: true,
							arrows: false,
		  				infinite: true,
		  				responsive: [
								{
		      				breakpoint: 1600,
		      				settings: {
		        				centerMode: true,
		        				centerPadding: '60px',
		        				slidesToShow: 3
		      				}
		    				},
		    				{
		      				breakpoint: 900,
		      				settings: {
		        				centerMode: true,
		        				centerPadding: '40px',
		        				slidesToShow: 2
		      				}
		    				},
		    				{
		      				breakpoint: 600,
		      				settings: {
		        				centerMode: true,
		        				centerPadding: '0px',
		        				slidesToShow: 1
		      				}
		    				}
		  				]
						}, featured.apps.slice(0, 6), AppMethods.largeCard);

						for (var i = 0; i < categories.length; i++) {
							html += ListMethods.row(categories[i], categories[i].apps, AppMethods.smallCard);
						}

						ElementUtils.append(main, html);
					});
				});
			} else if (args.page == "app") {
				setLoading();

				getApp(args.package, function(app) {
					ElementUtils.clearElement(main);

					document.body.style.background = "url(\"" + app.header + "\") 100% 100% / 9999% 9999% no-repeat fixed";
					main.style.background = "#FFF";
					ElementUtils.append(main, "<div class=\"header loadingimage\" style=\"background: url(\'" + app.header + "\') center / cover no-repeat;\"></div>"
						+ "<div class=\"appinfo\"><div class=\"appiconinfo\"><img class=\"appicon\" src=\"" + app.icon + "\"><button class=\"outline\" onclick=\"setPage(\'page=reviews&package=" + app.package + "&write\')\">RATE / REVIEW</button></div>"
						+ "<div class=\"appnameinfo\"><h1>" + app.name + "</h1><h3><a href=\"javascript:setPage(\'page=user&id=" + app.author.id + "\');\">" + app.author.name + "</a></h3><p>" + app.summary + "</p>"
						+ ListMethods.overflow({}, app.links, LinkMethods.normal) + "</div></div>");

					appendAppDownloadSection(app, true, main, args);

					if (app.screenshots && app.screenshots.length > 0) {
						ElementUtils.append(main, ListMethods.carousel({
							slidesToShow: 4,
							dots: app.screenshots.length > 4,
							arrows: false,
							variableWidth: true,
							infinite: false,
							responsive: [
								{
									breakpoint: 1600,
									settings: {
										dots: app.screenshots.length > 3,
										slidesToShow: 3
									}
								},
								{
									breakpoint: 900,
									settings: {
										dots: app.screenshots.length > 2,
										slidesToShow: 2
									}
								},
								{
									breakpoint: 600,
									settings: {
										dots: app.screenshots.length > 1,
										slidesToShow: 1
									}
								}
							]
						}, app.screenshots, ImageMethods.card));
					}

					ElementUtils.append(main, "<div class=\"appdesc\"><p>" + app.description + "</p></div>"
						+ ListMethods.overflow({}, app.categories, CategoryMethods.chip));

					var downloadsColor = "#000";
					if (app.downloads > 50000)
						downloadsColor = "#3F51B5";
					else if (app.downloads > 5000)
						downloadsColor = "#15AF5E";
					else if (app.downloads > 1000)
						downloadsColor = "#2962FF";

					ElementUtils.append(main, (app.rating || app.downloads ? "<div class=\"row grid inner-shadow\">"
						+ (app.rating ? "<div style=\"text-align: center;\"><h1 style=\"color: " + SiteUtils.getRatingColor(app.rating) + ";\">" + app.rating + "</h1><h4>Average Rating</h4></div>" : "")
						+ (app.downloads ? "<div style=\"text-align: center;\"><h1 style=\"color: " + downloadsColor + ";\">" + app.downloads + "</h1><h4>Downloads</h4></div>" : "")
						+ "</div>" : "")
						+ (app.reviews && app.reviews.length > 0 ? ListMethods.grid({"name": "Reviews"}, app.reviews, ReviewMethods.normal)
						+ "<a class=\"indented\" href=\"javascript:setPage(\'page=reviews&package=" + app.package + "\');\"><i class=\"material-icons\">open_in_new</i>ALL REVIEWS</a>" : "")
						+ "<a class=\"indented\" href=\"javascript:setPage(\'page=reviews&package=" + app.package + "&write\');\"><i class=\"material-icons\">rate_review</i>WRITE A REVIEW</a><br><br>"
					);
				});
			} else if (args.page == "reviews") {
				if (args.id) {
					setLoading();

					getReview(args.id, function(review) {
						console.log(ReviewMethods.big(review));
						ElementUtils.clearElement(main);
						ElementUtils.append(main, "<div class=\"single\">" + ReviewMethods.big(review) + "</div>"
							+ (currentUser && review.author.id == currentUser.uid ? "<hr><a style=\"display: block; text-align: center; padding: 0.5em 0;\" href=\"javascript:setPage(\'page=reviews&package=" + review.app.package + "&write\');\"><i class=\"material-icons\">rate_review</i>Edit</a>" : ""));
					});
				} else if (args.write) {
					if (currentUser) {
						getReview(args.package.split(".").join("_") + "-" + currentUser.uid, function(review) {
							ElementUtils.append(main, "<div class=\"dialog\"><div>"
								+ "<h2 style=\"margin: 0; margin-bottom: 0.5em;\">Rate / Review</h2>"
								+ "<div style=\"text-align: center;\">"
								+ "<div id=\"ratingSelect\" class=\"rating active\"><span>&#9734;</span><span>&#9734;</span><span>&#9734;</span><span>&#9734;</span><span>&#9734;</span></div>"
								+ "</div>"
								+ "<div id=\"reviewContent\" class=\"input long\" contentEditable=\"true\" placeholder=\"Write a review...\" onkeyup=\"document.getElementById(\'reviewCharacterCount\').innerText = innerText.length;\">"
								+ (review ? review.review : "") + "</div>"
								+ "<small id=\"reviewCharacterCount\" style=\"float: right;\">" + (review ? review.review.length : "0") + "</small><br>"
								+ "<small id=\"reviewErrorMessage\" style=\"color: red; display: none;\">Reviews should be between 50 and 1000 characters.</small>"
								+ "<div>"
								+ "<a id=\"reviewSubmit\" style=\"float: right;\">SUBMIT</a>"
								+ "<a style=\"float: right; margin-right: 1em;\" href=\"javascript:window.history.back();\">CANCEL</a>"
								+ "</div>"
								+ "</div></div>");

							var onRatingSelect = function(e) {
								if (e.target.className && e.target.className.indexOf("selected") >= 0) {
									e.target.className = null;
								} else {
									var ratingElement = document.getElementById("ratingSelect");
									for (var i = 0; i < ratingElement.childNodes.length; i++) {
										ratingElement.childNodes[i].className = null;
									}

									e.target.className = "selected";
								}
							};

							var ratingElement = document.getElementById("ratingSelect");
							for (var i = 0; i < ratingElement.childNodes.length; i++) {
								ratingElement.childNodes[i].addEventListener("click", onRatingSelect);
							}

							if (review) {
								ratingElement.childNodes[5 - review.rating].className = "selected";
							}

							document.getElementById("reviewSubmit").addEventListener("click", function() {
								var review = document.getElementById("reviewContent").innerText;
								var ratingElement = document.getElementById("ratingSelect");
								var rating = 0;
								for (var i = 0; i < ratingElement.childNodes.length; i++) {
									if (ratingElement.childNodes[i].className.indexOf("selected") >= 0) {
										rating = 5 - i;
										break;
									}
								}

								if (rating > 0) {
									if (review.length > 50 && review.length < 500) {
										setReview(args.package, currentUser, rating, review, function() {
											console.log("yay, stuff");
											window.history.back();
										}, true);
									} else {
										var errorElement = document.getElementById("reviewErrorMessage");
										errorElement.innerText = "Reviews should be between 50 and 1000 characters.";
										errorElement.style.display = null;
									}
								} else {
									var errorElement = document.getElementById("reviewErrorMessage");
									errorElement.innerText = "You must specify a rating before submitting a review!";
									errorElement.style.display = null;
								}
							});
						}, true);

						shouldScrollTop = false;
					} else {
						setPage("page=signin");
						return;
					}
				} else if (args.package) {
					setLoading();

					getAppReviews(args.package, function(reviews) {
						ElementUtils.clearElement(main);

						ElementUtils.append(main, "<div class=\"single\">" + ListMethods.grid({"name": "Reviews"}, reviews, ReviewMethods.normal) + "</div>"
							+ "<hr><a style=\"display: block; text-align: center; padding: 0.5em 0;\" href=\"javascript:setPage(\'page=reviews&package=" + args.package + "&write\');\"><i class=\"material-icons\">rate_review</i>Write a Review</a><br>");
					});
				} else {
					setPage("page=404");
					return;
				}
			} else if (args.page == "releases") {
				setLoading();

				getApp(args.package, function(app) {
					ElementUtils.clearElement(main);

					ElementUtils.append(main, "<div id=\"singleReleases\" class=\"single\"></div>");
					appendAppDownloadSection(app, false, document.getElementById("singleReleases"), args);
				});
			} else if (args.page == "category") {
				setLoading();

				getCategory(args.id, function(category) {
					ElementUtils.clearElement(main);

					document.body.style.background = category.background ? category.background : "inherit";
					ElementUtils.append(main, ListMethods.overflow(category, category.apps, AppMethods.tinyCard));
				});
			} else if (args.page == "signin") {
				ElementUtils.clearElement(main);
				ElementUtils.append(main, "<div style=\"padding: calc(5vw + 1em);\">"
					+ "<p>Sign-in has been disabled. See the notice on the homepage for more information.</p>"
					+ "</div>");

				/*if (firebaseUI) {
					firebaseUI.reset();
				} else {
					firebaseUI = new firebaseui.auth.AuthUI(firebase.auth());
				}

      			firebaseUI.start('#auth-container', {
        			signInSuccessUrl: "javascript:setPage(\'page=home\');",
        			signInOptions: [
          				firebase.auth.GoogleAuthProvider.PROVIDER_ID,
          				firebase.auth.TwitterAuthProvider.PROVIDER_ID,
          				firebase.auth.GithubAuthProvider.PROVIDER_ID,
          				firebase.auth.EmailAuthProvider.PROVIDER_ID
        			],
        			tosUrl: 'https://doubledotlabs.github.io/tos/?ddc'
      			});*/
			} else if (args.page == "user") {
				if (args.id && !(currentUser && args.id == currentUser.uid)) {
					setLoading();

					getUser(args.id, function(user) {
						ElementUtils.clearElement(main);

						var html = "<div class=\"userinfo\">"
							+ "<img class=\"userimage\" src=\"" + user.image + "\">"
							+ "<span>" + user.name + "</span>"
							+ (user.links && user.links.length > 0 ? ListMethods.overflow({}, user.links, LinkMethods.normal) : "")
							+ "</div>";

						if (user.apps && user.apps.length > 0) {
							html += "<hr>"
								+ "<h1 class=\"indented\">Apps</h1>"
							  + ListMethods.overflow({}, user.apps, AppMethods.tinyCard);
						}

						if (user.reviews && user.reviews.length > 0) {
							html += "<hr>"
								+ "<h1 class=\"indented\">Reviews</h1>"
								+ ListMethods.grid({}, user.reviews, ReviewMethods.normal);
						}

						ElementUtils.append(main, html);
					});
				} else {
					if (currentUser) {
						setLoading();

						if (args.edit) {
								getUser(currentUser.uid, function(user) {
									ElementUtils.clearElement(main);
									
									ElementUtils.append(main, "<h1 style=\"text-align: center;\">Edit Profile</h1>"
										+ "<div class=\"userinfo editable\">"
										+ "<h4>Username</h4>"
										+ "<div id=\"editUserName\" class=\"input long\" contentEditable=\"true\" onkeyup=\"document.getElementById(\'userNameCharCount\').innerText = innerText.length;\">" + user.name + "</div>"
										+ "<small id=\"userNameCharCount\" style=\"float: right; margin: 0 2em; margin-top: -2em;\">" + user.name.length + "</small>"
										+ "</div>"
										+ "<div class=\"userinfo\">"
										+ "<h4>Links</h4>"
										+ "<div id=\"editLinks\" class=\"row overflow\" style=\"text-align: center; justify-content: center;\">"
										+ (user.links && user.links.length > 0 ? ListMethods.none({}, user.links, LinkMethods.editableSansCategories) : LinkMethods.editableSansCategories())
										+ "<div style=\"width: 100%;\"><a id=\"editAddLink\"><i class=\"material-icons\">add</i></a><a id=\"editRemoveLink\"><i class=\"material-icons\">remove</i></a></div>"
										+ "</div><br><div style=\"float: right; text-align: right; margin: 3em;\"><small id=\"editUserErrorMessage\" style=\"display: none; color: red;\"></small><br>"
										+ "<button id=\"editUserSubmit\" class=\"outline\" style=\"margin: .5em;\">SAVE</button>"
										+ "<button onclick=\"window.history.back();\" class=\"outline\" style=\"margin: .5em;\">CANCEL</button></div><br><br></div>");

									var editLinksElement = document.getElementById("editLinks");
									var editAddLinkElement = document.getElementById("editAddLink");
									var editRemoveLinkElement = document.getElementById("editRemoveLink");

									editAddLinkElement.addEventListener("click", function() {
										if (editLinksElement.childNodes.length < 10) {
											editLinksElement.insertBefore(ElementUtils.createElement(LinkMethods.editableSansCategories()), editLinksElement.lastChild);
											onSizeChange();
										}
									});

									editRemoveLinkElement.addEventListener("click", function() {
										if (editLinksElement.childNodes.length >= 2) {
											editLinksElement.removeChild(editLinksElement.childNodes[editLinksElement.childNodes.length - 2]);
											onSizeChange();
										}
									});

									document.getElementById("editUserSubmit").addEventListener("click", function() {
										var editUserNameElement = document.getElementById("editUserName");
										if (editUserNameElement.innerText.length > 1 && editUserNameElement.innerText.length < 50) {
											var links = [];
											for (var i = 0; i < editLinksElement.childNodes.length; i++) {
												var linkName = null, linkUrl = null;
												var child = editLinksElement.childNodes[i];
												if (child.tagName.toLowerCase() == "div") {
													if (child.childNodes[0] && child.childNodes[0].tagName.toLowerCase() == "div") {
														linkName = child.childNodes[0].innerText;
													}

													if (child.childNodes[1] && child.childNodes[1].tagName.toLowerCase() == "div") {
														linkUrl = child.childNodes[1].innerText;
													}

													if (linkName && linkUrl) {
														links.push({
															"name": linkName,
															"url": linkUrl
														});
													}
												}
											}

											setUser(currentUser.uid, editUserNameElement.innerText, links, function() {
												window.history.back();
											});
										} else {
											var errorMessageElement = document.getElementById("editUserErrorMessage");
											if (editUserNameElement.innerText.length < 2)
												errorMessageElement.innerText = "Your username must be at least two characters!";
											else errorMessageElement.innerText = "Your username must be less than 50 characters!";
											errorMessageElement.style.display = null;
										}
									});
								}, true);
						} else {
							ElementUtils.clearElement(main);

							ElementUtils.append(main, "<div class=\"userinfo\">"
								+ "<img class=\"userimage\" src=\"" + currentUser.photoURL + "\">"
								+ "<span id=\"userDisplayName\">" + currentUser.displayName + "</span>"
								+ "<span>" + currentUser.email + "</span>"
								+ "<div class=\"row overflow\">"
								+ "<a class=\"link\" href=\"javascript:setPage(\'page=user&edit\');\"><i class=\"material-icons\">edit</i>EDIT</a>"
								+ "<a class=\"link\" href=\"javascript:signOut();\"><i class=\"material-icons\">exit_to_app</i>SIGN OUT</a>"
								+ "</div>"
								+ "</div>");

							getUser(currentUser.uid, function(user) {
								if (main.childNodes.length != 1)
									return;

								if (currentUser.displayName != user.name) {
									document.getElementById("userDisplayName").innerText = user.name;
								}

								var html = "";
								if (user.links && user.links.length > 0) {
									html += "<hr><div class=\"userinfo\">"
										+ ListMethods.overflow({}, user.links, LinkMethods.normal)
										+ "</div>";
								}

								if (user.apps && user.apps.length > 0) {
									html += "<hr>"
										+ "<h1 class=\"indented\">Apps</h1>"
									  + ListMethods.overflow({}, user.apps, AppMethods.tinyCard);
								}

								if (user.reviews && user.reviews.length > 0) {
									html += "<hr>"
										+ "<h1 class=\"indented\">Reviews</h1>"
										+ ListMethods.grid({}, user.reviews, ReviewMethods.normal);
								}

								ElementUtils.append(main, html);
							}, true);
						}
					} else {
						setPage("page=404");
						return;
					}
				}
			} else if (args.page == "search") {
				if (args.query && args.query.length > 0) {
					setLoading();

					searchElement.value = args.query;
					searchApps(args.query, function(apps) {
						ElementUtils.clearElement(main);
						if (apps && apps.length > 0) {
							ElementUtils.append(main, ListMethods.overflow({}, apps, AppMethods.tinyCard));
						} else {
							ElementUtils.append(main, "<div class=\"indented\" style=\"text-align: center;\"><p style=\"color: rgba(0, 0, 0, 0.5); color: var(--normal-color-half);\">Unfortunately, it seems there aren\'t any results for your search query.</p></div>");
						}
					});
				} else {
					ElementUtils.clearElement(main);
					ElementUtils.append(main, "<div class=\"indented\" style=\"text-align: center;\"><p style=\"color: rgba(0, 0, 0, 0.5); color: var(--normal-color-half);\">Type something, then press \'enter\' to search...</p></div>");
				}
			} else {
				page = "page=404";
				ElementUtils.clearElement(main);
				ElementUtils.append(main, "<div class=\"indented\"><h1>Error 404</h1><p>Sorry, we couldn\'t find what you\'re looking for.</p><button class=\"outline\" onclick=\"window.history.back();\">GO BACK</button></div>");
			}

		  if (replace)
				window.history.replaceState({}, "", page ? "?" + page : "?");
			else {
				window.history.pushState({}, "", page ? "?" + page : "?");
				if (shouldScrollTop)
					window.scrollTo(0, 0);
			}

			onSizeChange();
		}

		function appendAppDownloadSection(app, shouldShorten, element, args) {
			if (!app.releases || app.releases.length < 1)
				return;

			var configurations = [];
			var sdks = [];
			var architectures = [];
			var dpis = [];

			for (var i = 0; i < app.releases.length; i++) {
				var release = app.releases[i];
				for (var i2 = 0; i2 < release.downloads.length; i2++) {
					var download = release.downloads[i2];

					var config = download.config ? download.config : "phone";
					if (configurations.indexOf(config) == -1)
						configurations.push(config);

					if (sdks.indexOf(download.min) == -1)
						sdks.push(download.min);
					if (download.max && sdks.indexOf(download.max) == -1)
						sdks.push(download.max);

					var arch = download.arch ? download.arch : "all";
					if (architectures.indexOf(arch) == -1)
						architectures.push(arch);

					if (download.minDpi && dpis.indexOf(download.minDpi) == -1)
						dpis.push(download.minDpi);
					if (download.maxDpi && dpis.indexOf(download.maxDpi) == -1)
						dpis.push(download.maxDpi);
				}
			}

			var getDownloadsForConfig = function(config, sdk, arch, dpi) {
				var sdkArray = sdk ? sdk.split("/") : [];
				var dpiArray = dpi ? dpi.split("/") : [];

				var items = [];
				for (var i = 0; i < app.releases.length; i++) {
					var release = app.releases[i];
					for (var i2 = 0; i2 < release.downloads.length; i2++) {
						var download = release.downloads[i2];

						if ((!config || download.config == config || (config == "phone" && !download.config))
								&& (!sdk || ((download.min < sdkArray[1] || sdkArray[1] == -1) && (!download.max || download.max > sdkArray[0])))
								&& (!arch || download.arch == arch || arch == "all")
								&& (!dpi || ((!download.minDpi || (download.minDpi ? download.minDpi : 0) < dpiArray[1] || dpiArray[1] == -1) && (!download.maxDpi || download.maxDpi > dpiArray[0])))) {
							items.push({
								"release": release,
								"download": download
							});
						}
					}
				}

				return items;
			};

			var configurationsHtml = "";
			for (var i = 0; i < configurations.length; i++) {
				var text = null;
				if (configurations[i] == "phone")
					text = "Phone";
				else if (configurations[i] == "wear")
					text = "Android Wear";
				else if (configurations[i] == "auto")
					text = "Android Auto";
				else if (configurations[i] == "tv")
					text = "Android TV";

				configurationsHtml += "<option value=\"" + configurations[i] + "\">" + text + "</option>"
			}

			sdks.sort(function(a, b) {
				return a - b;
			});

			var sdksHtml = "<option value=\"0/-1\">All Android Versions</option>";

			if (sdks.length > 0) {
				sdksHtml = getDownloadsForConfig(null, "0/" + sdks[0], null, null).length > 0
						? "<option value=\"0/" + sdks[0] + "\">Below Android " + AndroidUtils.sdkToVersion(sdks[0]) + "</option>"
						: "";

				for (var i = 0; i < sdks.length; i++) {
					var text = null;
					var id = null;
					if (i + 1 < sdks.length) {
						text = "Android " + AndroidUtils.sdkToVersion(sdks[i]) + " - " + AndroidUtils.sdkToVersion(sdks[i + 1]);
						id = sdks[i] + "/" + sdks[i + 1];
					} else {
						text = "Android " + AndroidUtils.sdkToVersion(sdks[i]) + "+";
						id = sdks[i] + "/-1";
					}

					if (getDownloadsForConfig(null, id, null, null).length > 0)
						sdksHtml += "<option value=\"" + id + "\">" + text + "</option>";
				}
			}

			var architecturesHtml = "";
			for (var i = 0; i < architectures.length; i++) {
				architecturesHtml += "<option value=\"" + architectures[i] + "\">" + architectures[i] + "</option>"
			}

			dpis.sort(function(a, b) {
				return a - b;
			});

			var dpisHtml = "<option>nodpi</option>";

			if (dpis.length > 0) {
				dpisHtml = getDownloadsForConfig(null, null, null, "0/" + dpis[0]).length > 0
						? "<option value=\"0/" + dpis[0] + "\">&le; " + dpis[0] + " dpi</option>"
						: "";

				for (var i = 0; i < dpis.length; i++) {
					var text = null;
					var id = null;
					if (i + 1 < dpis.length) {
						text = dpis[i] + " - " + dpis[i + 1] + " dpi";
						id = dpis[i] + "/" + dpis[i + 1];
					} else {
						text = "&ge; " + dpis[i] + " dpi";
						id = dpis[i] + "/-1";
					}

					if (getDownloadsForConfig(null, null, null, id).length > 0)
						dpisHtml += "<option value=\"" + id + "\">" + text + "</option>";
				}
			}

			ElementUtils.append(element, "<div class=\"row grid\">"
				+ "<div><i class=\"material-icons\">devices_other</i><div class=\"dropdown\"><span>Configuration</span>"
				+ "<select id=\"configSelect\"" + (configurations.length > 1 ? "" : " class=\"disabled\"") + ">" + configurationsHtml + "</select></div></div>"
				+ "<div><i class=\"material-icons\">android</i><div class=\"dropdown\"><span>Android Version</span>"
				+ "<select id=\"sdkSelect\"" + (sdks.length > 1 ? "" : " class=\"disabled\"") + ">" + sdksHtml + "</select></div></div>"
				+ "<div><i class=\"material-icons\">memory</i><div class=\"dropdown\"><span>Architecture</span>"
				+ "<select id=\"archSelect\"" + (architectures.length > 1 ? "" : " class=\"disabled\"") + ">" + architecturesHtml + "</select></div></div>"
				+ "<div><i class=\"material-icons\">devices</i><div class=\"dropdown\"><span>Screen Density</span>"
				+ "<select id=\"dpiSelect\"" + (dpis.length > 1 ? "" : " class=\"disabled\"") + ">" + dpisHtml + "</select></div></div>"
				+ "</div>");

			ElementUtils.append(element, "<div id=\"releases\" class=\"row grid\"></div>");

			if (args) {
				var configSelect = document.getElementById("configSelect");
				var sdkSelect = document.getElementById("sdkSelect");
				var archSelect = document.getElementById("archSelect");
				var dpiSelect = document.getElementById("dpiSelect");

				if (args.config) {
					configSelect.value = args.config;
				}

				if (args.sdk) {
					sdkSelect.value = args.sdk;
				}

				if (args.arch) {
					archSelect.value = args.arch;
				}

				if (args.dpi) {
					dpiSelect.value = args.dpi;
				}
			}

			var onSelect = function(shouldSkipUpdate) {
				var releasesElement = document.getElementById("releases");
				ElementUtils.clearElement(releasesElement);

				var configSelect = document.getElementById("configSelect");
				var sdkSelect = document.getElementById("sdkSelect");
				var archSelect = document.getElementById("archSelect");
				var dpiSelect = document.getElementById("dpiSelect");

				var items = getDownloadsForConfig(configSelect.value, sdkSelect.value, archSelect.value, dpiSelect.value);

				if (items.length > 0) {
					if (shouldShorten && items.length > 4) {
						ElementUtils.append(releasesElement, ListMethods.none({}, items.slice(0, 4), DownloadMethods.normal)
							+ "<a style=\"width: 100%\" href=\"javascript:setPage(\'page=releases&package=" + app.package + "&config=" + config + "&sdk=" + sdk + "&arch=" + arch + "&dpi=" + dpi + "\');\">"
							+ "<i class=\"material-icons\">open_in_new</i>MORE RELEASES</a>");
					} else ElementUtils.append(releasesElement, ListMethods.none({}, items, DownloadMethods.normal));
				} else {
					ElementUtils.append(releasesElement, "<h3 style=\"text-align: center; margin: 0; width: 100%;\">There are no downloads available for the selected configuration.</h3>")
				}

				if (args) {
					args.config = configSelect.value;
					args.sdk = sdkSelect.value;
					args.arch = archSelect.value;
					args.dpi = dpiSelect.value;

					if (!(typeof shouldSkipUpdate == "boolean" && shouldSkipUpdate))
						window.history.replaceState({}, "", "?" + UrlUtils.argumentsToString(args));
				}
			}

			document.getElementById("configSelect").addEventListener("change", onSelect);
			document.getElementById("sdkSelect").addEventListener("change", onSelect);
			document.getElementById("archSelect").addEventListener("change", onSelect);
			document.getElementById("dpiSelect").addEventListener("change", onSelect);
			onSelect(true);
		}

		setPage(UrlUtils.getCurrentArguments(), true);

		window.onpopstate = function() {
			setPage(UrlUtils.getCurrentArguments(), true);
			console.log("h");
		}

		window.addEventListener("load", function() {
			firebase.auth().onAuthStateChanged(function(user) {
				currentUser = user;
				isCurrentUserLoading = false;

				if (user) {
					signInElement.style.display = "none";
					profileElement.style.display = null;

					profileNameElement.innerHTML = user.displayName;
					profileEmailElement.innerHTML = user.email;
					profilePictureElement.src = user.photoURL;

					if (UrlUtils.getCurrentArguments().page == "404")
						setPage("page=user", true);
				} else {
					profileElement.style.display = "none";
					signInElement.style.display = null;
				}
			}, function(error) {
				isCurrentUserLoading = false;
				console.error("Sign In Error", error);
				setPage("page=404");
			});
		});

		function signOut() {
			firebase.auth().signOut().then(function() {
				setPage("page=home");
			}, function(error) {
  			console.error('Sign Out Error', error);
				setPage("page=404");
			});
		}

		searchElement.addEventListener("click", function() {
			if (UrlUtils.getCurrentArguments().page != "search") {
				setPage("page=search");
			}
		});

		searchElement.addEventListener("keyup", function(e) {
			if (e.keyCode == 13) {
				setPage("page=search&query=" + searchElement.value, UrlUtils.getCurrentArguments().page == "search");
			}
		});

		function setLoading() {
			ElementUtils.clearElement(main);
			ElementUtils.append(main, "<div id=\"loading\"><img src=\"https://doubledotlabs.github.io/images/loading.svg\"><br><b>Loading...</b></div>");
		}

		function onSizeChange() {
			footer.style.position = null;
			var rect = footer.getBoundingClientRect();
			if ((rect.bottom || rect.y + rect.height) < Math.max(document.documentElement.clientHeight, window.innerHeight || 0))
				footer.style.position = "fixed";
			else footer.style.position = null;
		}

		window.onresize = onSizeChange;
		ElementUtils.addElementListenerStuff(document.body);
	</script>
</body>
</html>
